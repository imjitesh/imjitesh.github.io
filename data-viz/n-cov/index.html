<!DOCTYPE html>
<html lang="en">

<head>

	<title>Jitesh Motwani - India & International Solar Alliance</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
	<!-- Load d3.js and the geo projection plugin -->
	<script src="https://d3js.org/d3.v4.js"></script>
	<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="/css/dataset.main.css">
	<style type="text/css">
		#mapid {
			height: 500px;
			width: 100%;
			background-color: rgb(250, 250, 250);
		}
	</style>
</head>

<body style="margin:0; padding:0">
	<div class="bar" style="height:0px; width:100%; background-color:rgb(15, 20, 20);margin-bottom:50px"></div>
	<div class="row" style="margin-bottom:30px;">
		<div class="col-md-3"></div>
		<div class="col-md-6">
			<a href="/">
				<div style="width:72px;height:24px;background:#133345;color:white;text-align:center;font-weight:200;border-top-left-radius:5px;border-bottom-left-radius:5px;line-height:22px;display: inline-block;margin-right:0px;">Go Back</div>
			</a>
		</div>
		<div class="col-md-3"></div>
	</div>
	<div class="row" style="margin-bottom:30px;">
		<div class="col-md-3"></div>
		<div class="col-md-6">
			<h2>Coronavirus Map: Tracking the outbreak</h2>
		</div>
		<div class="col-md-3"></div>
	</div>
	<div class="row" style="margin-bottom:30px;">
		<div class="col-md-3"></div>
		<div class="col-md-6">
			<h4>CURRENT STATUS</h4>
			<span style="font-size:17px;">
			The coronavirus outbreak has sickened more than 43,000 people in Asia, according to statements from health officials. Many other cases are suspected but not confirmed. As of Monday evening, at least 1018 people have died, all but two in mainland China.
			<br><br>
			<h4>WHAT HAPPENED?</h4>
			The outbreak is believed to have began in a seafood and poultry market in Wuhan, a city of 11 million people in central China. The virus is readily transmitted from person to person, scientists believe. But how lethal the virus is and and whether it can be contained is unclear.
			<br><br>
			The below choropleth gives a timeline of the spread of the virus since it was first identified.
			<br><br>
			<select name="case_type">
				<option value="Confirmed">Confirmed</option>
  <option value="Recovered">Recovered</option>
  <option value="Deaths">Deaths</option>
</select>
		</span>
		</div>
		<div class="col-md-3"></div>
	</div>
	<div class="row" style="margin-bottom:30px;">
		<div class="col-md-2"></div>
		<div class="col-md-1" style="text-align:left;">
			<span style="background:#133345;color:white;text-align:center;font-weight:200;border-radius:4px;line-height:22px; padding:5px;">2020-01-21</span>
		</div>
		<div class="col-md-6">
			<div class="slidecontainer">
				<input type="range" min="1" max="10" value="1" class="slider" id="timeRange" onchange="updateSlider(this.value)">
			</div>
		</div>
		<div class="col-md-1" style="text-align:right;">
			<span style="background:#133345;color:white;text-align:center;font-weight:200;border-radius:4px;line-height:22px; padding:5px;">2020-02-11</span>
		</div>
		<div class="col-md-2"></div>
	</div>
	<div class="row" style="margin-bottom:30px;">
		<div class="col-md-2"></div>
		<div class="col-md-8">
			<svg id="my_dataviz" width="100%" height="650">
			</svg>
		</div>
		<div class="col-md-2"></div>
	</div>
	<script>
		// The svg
		var svg = d3.select("svg"),
			width = document.getElementById("my_dataviz").clientWidth,
			height = +svg.attr("height");

		// Map and projection
		var path = d3.geoPath();
		var projection = d3.geoMercator()
			.scale(150)
			.center([0, 45])
			.translate([width / 2, height / 2]);

		// Data and color scale
		var d3data = d3.map();
		let timestamp;
		let timestamps = [];
		var colorScale = d3.scaleThreshold()
			.domain([1, 5, 10, 20, 100, 500, 5000, 20000, 50000])
			.range(d3.schemeReds[8]);

		ncov_timeline_data = {
			"CHN": {},
			"JPN": {},
			"THA": {},
			"KOR": {},
			"SGP": {},
			"VNM": {},
			"FRA": {},
			"AUS": {},
			"NPL": {},
			"MYS": {},
			"PHL": {},
			"MEX": {},
			"BRA": {},
			"COL": {},
			"KHM": {},
			"USA": {},
			"DEU": {},
			"LKA": {},
			"CAN": {},
			"ARE": {},
			"GBR": {},
			"IND": {},
			"RUS": {},
			"ITA": {},
			"BEL": {},
			"ESP": {},
			"SWE": {},
			"FIN": {}
		};

		function createData(code, data, loc, timestamp) {
			//console.log(code, data, loc, timestamp);
			if (timestamp in ncov_timeline_data[code]) {
				ncov_timeline_data[code][timestamp].confirmed += +data[loc].split('-')[0];
				ncov_timeline_data[code][timestamp].recovered += +data[loc].split('-')[2];
				ncov_timeline_data[code][timestamp].death += +data[loc].split('-')[3];
			} else {
				ncov_timeline_data[code][timestamp] = {
					"confirmed": +data[loc].split('-')[0],
					"recovered": +data[loc].split('-')[2],
					"death": +data[loc].split('-')[3]
				};
			}
		}

		// Load external data and boot
		d3.queue()
			.defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
			//.defer(d3.csv, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world_population.csv",function(d) { d3data.set(d.code, +d.pop); })
			.defer(d3.csv, "https://cors-anywhere.herokuapp.com/https://hgis.uw.edu/virus/assets/virus.csv",
				function(data) {
					for (var loc in data) {
						if (loc == "datetime") {
							timestamp = data[loc].split(" ")[0];
							timestamps.push(timestamp);
						}
						if (["anhui", "beijing", "chongqing", "fujian", "gansu", "guangdong", "guangxi", "guizhou", "hainan", "hebei", "heilongjiang", "henan", "hongkong", "hubei", "hunan", "neimenggu", "jiangsu", "jiangxi", "jilin", "liaoning", "macau",
								"ningxia", "qinghai", "shaanxi", "shandong", "shanghai", "shanxi", "sichuan", "tianjin", "xinjiang", "xizang", "yunnan", "zhejiang"
							].indexOf(loc) > -1) {
							createData("CHN", data, loc, timestamp)
						}
						if (["japan"].indexOf(loc) > -1) {
							createData("JPN", data, loc, timestamp)
						}
						if (["thailand"].indexOf(loc) > -1) {
							createData("THA", data, loc, timestamp)
						}
						if (["south korea"].indexOf(loc) > -1) {
							createData("KOR", data, loc, timestamp)
						}
						if (["singapore"].indexOf(loc) > -1) {
							createData("SGP", data, loc, timestamp)
						}
						if (["vietnam"].indexOf(loc) > -1) {
							createData("VNM", data, loc, timestamp)
						}
						if (["france"].indexOf(loc) > -1) {
							createData("FRA", data, loc, timestamp)
						}
						if (["australia"].indexOf(loc) > -1) {
							createData("AUS", data, loc, timestamp)
						}
						if (["nepal"].indexOf(loc) > -1) {
							createData("NPL", data, loc, timestamp)
						}
						if (["malaysia"].indexOf(loc) > -1) {
							createData("MYS", data, loc, timestamp)
						}
						if (["philippines"].indexOf(loc) > -1) {
							createData("PHL", data, loc, timestamp)
						}
						if (["mexico"].indexOf(loc) > -1) {
							createData("MEX", data, loc, timestamp)
						}
						if (["brazil"].indexOf(loc) > -1) {
							createData("BRA", data, loc, timestamp)
						}
						if (["colombia"].indexOf(loc) > -1) {
							createData("COL", data, loc, timestamp)
						}
						if (["cambodia"].indexOf(loc) > -1) {
							createData("KHM", data, loc, timestamp)
						}
						if (["us"].indexOf(loc) > -1) {
							createData("USA", data, loc, timestamp)
						}
						if (["germany"].indexOf(loc) > -1) {
							createData("DEU", data, loc, timestamp)
						}
						if (["sri lanka"].indexOf(loc) > -1) {
							createData("LKA", data, loc, timestamp)
						}
						if (["canada"].indexOf(loc) > -1) {
							createData("CAN", data, loc, timestamp)
						}
						if (["united arab"].indexOf(loc) > -1) {
							createData("ARE", data, loc, timestamp)
						}
						if (["uk"].indexOf(loc) > -1) {
							createData("GBR", data, loc, timestamp)
						}
						if (["india"].indexOf(loc) > -1) {
							createData("IND", data, loc, timestamp)
						}
						if (["russia"].indexOf(loc) > -1) {
							createData("RUS", data, loc, timestamp)
						}
						if (["italy"].indexOf(loc) > -1) {
							createData("ITA", data, loc, timestamp)
						}
						if (["belgium"].indexOf(loc) > -1) {
							createData("BEL", data, loc, timestamp)
						}
						if (["spain"].indexOf(loc) > -1) {
							createData("ESP", data, loc, timestamp)
						}
						if (["sweden"].indexOf(loc) > -1) {
							createData("SWE", data, loc, timestamp)
						}
						if (["finland"].indexOf(loc) > -1) {
							createData("FIN", data, loc, timestamp)
						}
					}
				}
			)
			.await(ready);

let currentTimeStamp = '2020-01-21';

function updateSlider(currentTime){
	currentTimeStamp = timestamps[currentTime-1];
	for (var reg in ncov_timeline_data) {
		for (var time in ncov_timeline_data[reg]) {
			if (time == currentTimeStamp) {
				d3data.set(reg, +ncov_timeline_data[reg][time]["confirmed"])
			}
		}
	}
	d3.queue()
		.defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
		.await(ready);
}

		function ready(error, topo){
			$("#timeRange").attr("max", timestamps.length);
			for (var reg in ncov_timeline_data) {
				for (var time in ncov_timeline_data[reg]) {
					if (time == currentTimeStamp) {
						d3data.set(reg, +ncov_timeline_data[reg][time]["confirmed"])
					}
				}
			}
			let mouseOver = function(d) {
				d3.selectAll(".Country")
					.transition()
					.duration(200)
					.style("opacity", .1)
				d3.select(this)
					.transition()
					.duration(200)
					.style("opacity", 1)
					.style("stroke", "transparent")
			}

			let mouseLeave = function(d) {
				d3.selectAll(".Country")
					.transition()
					.duration(200)
					.style("opacity", 1)
				d3.select(this)
					.transition()
					.duration(200)
					.style("stroke", "transparent")
			}

			// Draw the map
			svg.append("g")
				.selectAll("path")
				.data(topo.features)
				.enter()
				.append("path")
				// draw each country
				.attr("d", d3.geoPath()
					.projection(projection)
				)
				// set the color of each country
				.attr("fill", function(d) {
					d.total = d3data.get(d.id) || 0;
					return colorScale(d.total);
				})
				.style("stroke", "transparent")
				.attr("class", function(d) {
					return "Country"
				})
				.style("opacity", 1)
				.on("mouseover", mouseOver)
				.on("mouseleave", mouseLeave)
		}
	</script>
</body>

</html>
